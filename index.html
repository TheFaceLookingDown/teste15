<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Site Protegido</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  :root{ --bg:#000; --fg:#fff; --err:#ff3b3b; }
  html,body{height:100%;}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family:'Press Start 2P', monospace;
    display:flex; align-items:center; justify-content:center;
    text-align:center; padding:20px;
  }
  .wrap{ width:100%; max-width:900px; position:relative; }

  #loginBox{ display:flex; flex-direction:column; align-items:center; gap:12px; }
  .pw-row{ display:flex; gap:8px; align-items:center; }
  .input-wrap{ position:relative; }
  input[type="password"], input[type="text"]{
    background:transparent; border:2px solid var(--fg); color:var(--fg);
    padding:12px 14px; outline:none; font-family:inherit; font-size:12px;
    width:320px; box-sizing:border-box;
  }
  button{
    padding:10px 14px; background:transparent; border:2px solid var(--fg);
    color:var(--fg); cursor:pointer; font-family:inherit; font-size:11px;
    text-transform:uppercase; letter-spacing:1px;
  }
  #eyeBtn{ padding:8px; min-width:44px; }

  #errorMsg{
    color:var(--err);
    font-size:10px;
    height:18px;
    visibility:hidden;
  }
  #errorMsg.show{ visibility:visible; }

  #soundToggle{ position:fixed; right:12px; top:12px; background:transparent; border:2px solid var(--fg); padding:8px; }

  #content{ display:none; opacity:0; transition:opacity .45s ease; flex-direction:column; align-items:center; }
  #content.show{ display:flex; opacity:1; }
  #mainImage{
    max-width:80%; max-height:45vh; object-fit:contain; border:2px solid var(--fg);
    margin-bottom:18px; position:relative; overflow:hidden;
    filter: drop-shadow(0 0 6px rgba(255,255,255,0.06));
  }
  .crt-wrap{ position:relative; display:inline-block; overflow:hidden; }
  .crt-scan{ position:absolute; inset:0; pointer-events:none; background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 50%, rgba(255,255,255,0.03) 100%); background-size: 100% 4px; mix-blend-mode:screen; opacity:0.9; }
  .crt-flicker{ position:absolute; inset:0; pointer-events:none; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(0,0,0,0)); mix-blend-mode:overlay; opacity:0.18; animation: flicker 0.12s infinite; }
  @keyframes flicker{ 0%{ opacity:0.14 } 50%{ opacity:0.18 } 100%{ opacity:0.12 } }
  .reveal-band{ position:absolute; left:-120%; top:0; width:120%; height:100%; background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0) 100%); transform: skewX(-10deg); pointer-events:none; animation: bandMove 900ms ease forwards; }
  @keyframes bandMove{ 0%{ left:-120%; opacity:0 } 40%{ left:5%; opacity:1 } 100%{ left:120%; opacity:0 } }

  #title{ font-size:14px; margin:8px 0 20px 0; line-height:1.1; max-width:900px; }
  #text{ font-size:10px; max-width:820px; white-space:pre-wrap; text-align:center; }

  #terminal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:#000; z-index:40; color:var(--fg); font-family:inherit; font-size:11px; visibility:hidden; }
  #terminal.show{ visibility:visible; }

  @media (max-width:420px){
    input[type="password"]{ width:90%; }
    #title{ font-size:9px; } #text{ font-size:8px; }
  }
</style>
</head>
<body>

<div class="wrap">
  <button id="soundToggle" aria-pressed="true">Som</button>

  <div id="loginBox" aria-hidden="false">
    <div class="pw-row">
      <div class="input-wrap">
        <input id="passwordInput" type="password" placeholder="Digite a senha" autocomplete="off" />
      </div>
      <button id="eyeBtn" title="Mostrar senha">Mostrar</button>
    </div>

    <div style="display:flex; gap:12px; justify-content:center; margin-top:8px;">
      <button id="enterBtn">Entrar</button>
      <button id="clearBtn">Limpar</button>
    </div>

    <div id="errorMsg" role="alert" aria-live="assertive"></div>
  </div>

  <div id="content" aria-hidden="true" role="region">
    <div class="crt-wrap">
      <img id="mainImage" src="" alt="" />
      <div class="crt-scan" aria-hidden="true"></div>
      <div class="crt-flicker" aria-hidden="true"></div>
    </div>

    <h1 id="title"></h1>
    <div id="text"></div>
  </div>
</div>

<div id="terminal" role="status" aria-live="polite">
  <div><div id="termLine">Verificando credenciais...</div></div>
</div>

<script>
const pwInput = document.getElementById('passwordInput');
const enterBtn = document.getElementById('enterBtn');
const clearBtn = document.getElementById('clearBtn');
const eyeBtn = document.getElementById('eyeBtn');
const loginBox = document.getElementById('loginBox');
const errorMsg = document.getElementById('errorMsg');
const content = document.getElementById('content');
const mainImage = document.getElementById('mainImage');
const titleEl = document.getElementById('title');
const textEl = document.getElementById('text');
const terminal = document.getElementById('terminal');
const termLine = document.getElementById('termLine');
const soundToggle = document.getElementById('soundToggle');

let CONFIG = {
  senha: "",
  titulo: "",
  texto: "",
  imagem: "zero.jpg",
  terminalDelayMs: 700,
  typingSpeed: 16,
  keyBeepFreq: 1600,
  keyBeepShort: 0.03
};

// caracteres de “censura”
const censChars = ['#','@','%','$','!','¨','&','*'];

// carregar arquivos txt
async function loadTXT(file){ 
  const res = await fetch(file); 
  if(!res.ok) return "";
  return await res.text();
}

// substitui '*' por caracteres alternados
function applyCensorship(str){
  return str.split('').map(c=>{
    if(c==='*') return censChars[Math.floor(Math.random()*censChars.length)];
    return c;
  }).join('');
}

// inicializa CONFIG
async function initConfig(){
  CONFIG.senha = (await loadTXT('senha.txt')).trim();
  CONFIG.titulo = (await loadTXT('titulo.txt')).trim();
  CONFIG.texto = (await loadTXT('texto.txt')).trim();
}
initConfig();

pwInput.focus();

/* audio simples */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx=null, soundEnabled=true;
function ensureAudioCtx(){ if(!audioCtx) audioCtx=new AudioCtx(); }
function beep(freq=CONFIG.keyBeepFreq,duration=CONFIG.keyBeepShort, type='sine', vol=0.08){
  if(!soundEnabled) return;
  ensureAudioCtx();
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(audioCtx.destination);
  o.start(); g.gain.setValueAtTime(0.0001,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(vol,audioCtx.currentTime+0.005);
  g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+duration);
  o.stop(audioCtx.currentTime+duration+0.02);
}
function keyBeep(){ beep(CONFIG.keyBeepFreq + (Math.random()*200-100), CONFIG.keyBeepShort, 'square', 0.035); }
function successSound(){ beep(900,0.1,'sine',0.12); setTimeout(()=>beep(1400,0.06,'sine',0.08),90); }
function errorSound(){ beep(220,0.12,'sawtooth',0.14); }

soundToggle.addEventListener('click', ()=>{
  soundEnabled = !soundEnabled;
  soundToggle.textContent = soundEnabled ? 'Som' : 'Mudo';
  soundToggle.setAttribute('aria-pressed', String(soundEnabled));
});

let lastKeyTime=0;
pwInput.addEventListener('keydown', e=>{
  const now=Date.now();
  if(now-lastKeyTime>28){
    if(e.key.length===1 || e.key==='Backspace' || e.key==='Delete') keyBeep();
    lastKeyTime=now;
  }
  if(e.key==='Enter'){ e.preventDefault(); attemptEnter(); }
});

eyeBtn.addEventListener('click', ()=>{
  const type = pwInput.type==='password' ? 'text':'password';
  pwInput.type=type;
  eyeBtn.textContent = type==='password' ? 'Mostrar':'Ocultar';
  pwInput.focus();
});

enterBtn.addEventListener('click', ()=>{ keyBeep(); attemptEnter(); });
clearBtn.addEventListener('click', ()=>{ keyBeep(); pwInput.value=''; pwInput.focus(); });

function showTerminal(){ terminal.classList.add('show'); termLine.textContent='Verificando credenciais...'; }
function hideTerminal(){ terminal.classList.remove('show'); }
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
function showError(text){ errorMsg.textContent=text; errorMsg.classList.add('show'); errorMsg.animate([{opacity:0},{opacity:1}], {duration:260,easing:'ease'}); }
function clearError(){ errorMsg.textContent=''; errorMsg.classList.remove('show'); }

async function attemptEnter(){
  clearError();
  showTerminal();
  await sleep(CONFIG.terminalDelayMs);
  hideTerminal();
  if(pwInput.value === CONFIG.senha){
    successSound();
    revealContent();
  } else {
    errorSound();
    showError('Senha incorreta — tente novamente.');
    pwInput.focus();
  }
}

async function revealContent(){
  titleEl.textContent = CONFIG.titulo;
  textEl.textContent = '';

  mainImage.src = CONFIG.imagem;
  mainImage.alt = CONFIG.titulo || 'Imagem';

  loginBox.style.display='none';
  content.classList.add('show');
  content.setAttribute('aria-hidden','false');

  const wrapper = mainImage.parentElement;
  const prevBand = wrapper.querySelector('.reveal-band');
  if(prevBand) prevBand.remove();
  const band=document.createElement('div');
  band.className='reveal-band';
  wrapper.appendChild(band);
  await sleep(920);

  await typeText(CONFIG.texto);
}

async function typeText(full){
  const el=textEl;
  el.textContent='';
  for(let i=0;i<full.length;i++){
    let char = full[i];
    if(char==='*'){
      char = censChars[Math.floor(Math.random()*censChars.length)];
    }
    el.textContent += char;
    if(i%3===0) keyBeep();
    await sleep(CONFIG.typingSpeed);
  }
}

mainImage.addEventListener('error', ()=>{
  const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='800' height='450'><rect width='100%' height='100%' fill='black' stroke='white' stroke-width='6'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Press Start 2P,monospace' font-size='20' fill='white'>Imagem não encontrada</text></svg>`;
  mainImage.src='data:image/svg+xml;charset=utf-8,'+encodeURIComponent(svg);
});

pwInput.addEventListener('keypress', e=>{ if(e.key==='Enter'){ e.preventDefault(); attemptEnter(); } });
</script>
</body>
</html>
